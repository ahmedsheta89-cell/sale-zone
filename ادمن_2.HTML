<!DOCTYPE html>
<html lang="ar" dir="rtl" data-page="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0A1128">
    <meta name="description" content="Sale Zone Store Admin - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…">
    <link rel="icon" href="./icon-192.png">
    <link rel="shortcut icon" href="./icon-192.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Sale Zone Store</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Error Detection System -->
    <script src="ERROR_DETECTION_SYSTEM.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    <script src="firebase-api.js"></script>
    <script src="firebase-data.js"></script>
    <script src="auth-utils.js"></script>
    <script src="enhancement-utils.js"></script>
    <script src="storage-keys.js"></script>
    <script src="cloudinary-service.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F4E4BC;
            --gold-dark: #B8960C;
            --navy: #0A1128;
            --navy-light: #1A2744;
            --burgundy: #800020;
            --cream: #FAF8F3;
            --white: #FFFFFF;
            --success: #50C878;
            --error: #DC3545;
            --warning: #FFC107;
            --info: #17A2B8;
            --font-display: 'Playfair Display', serif;
            --font-arabic: 'Almarai', sans-serif;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.2);
            --transition: all 0.3s ease;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-arabic); background: #f5f6fa; min-height: 100vh; }

        /* Login */
        .login-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--navy), var(--navy-light));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-card {
            background: var(--white);
            border-radius: 20px;
            padding: 40px 35px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }
        .login-logo { font-size: 50px; margin-bottom: 15px; }
        .login-title { font-family: var(--font-display); font-size: 24px; color: var(--navy); margin-bottom: 8px; }
        .login-subtitle { color: #666; margin-bottom: 25px; font-size: 14px; }
        .login-form .form-group { margin-bottom: 18px; text-align: right; }
        .login-form label { display: block; font-weight: 600; color: var(--navy); margin-bottom: 6px; font-size: 13px; }
        .login-form input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
        }
        .login-form input:focus { border-color: var(--gold); outline: none; }
        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(212,175,55,0.4); }
        .login-error { background: #fee; color: var(--error); padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; font-size: 13px; }
        .back-link { margin-top: 20px; color: var(--gold-dark); text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 13px; }

        /* Dashboard */
        .dashboard { display: none; min-height: 100vh; }
        .dashboard.active { display: flex; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--navy), var(--navy-light));
            min-height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }
        .sidebar-header {
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar-logo { font-family: var(--font-display); font-size: 20px; color: var(--gold); }
        .sidebar-subtitle { font-size: 11px; color: var(--gold-light); margin-top: 3px; }
        .sidebar-menu { padding: 15px 0; }
        .menu-section { padding: 0 12px; margin-bottom: 8px; }
        .menu-section-title {
            font-size: 10px;
            color: rgba(255,255,255,0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 12px;
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 11px 15px;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 3px;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            font-size: 13px;
            font-family: var(--font-arabic);
        }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: var(--white); }
        .menu-item.active { background: linear-gradient(135deg, var(--gold), var(--gold-dark)); color: var(--white); }
        .menu-item .badge {
            margin-right: auto;
            background: var(--burgundy);
            color: var(--white);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }

        /* Main */
        .main-content {
            flex: 1;
            margin-right: var(--sidebar-width);
            padding: 20px;
            min-height: 100vh;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: var(--white);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            flex-wrap: wrap;
            gap: 12px;
        }
        .page-title {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--navy);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .top-bar-actions { display: flex; align-items: center; gap: 10px; }
        .admin-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--cream);
            border-radius: 20px;
            font-size: 13px;
        }
        .admin-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 12px;
        }
        .logout-btn {
            background: var(--error);
            color: var(--white);
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
        }
        .logout-btn:hover { background: #c0392b; }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--white);
            border-radius: 14px;
            padding: 18px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 3px;
        }
        .stat-card.products::before { background: var(--gold); }
        .stat-card.orders::before { background: var(--success); }
        .stat-card.users::before { background: var(--info); }
        .stat-card.revenue::before { background: var(--burgundy); }
        .stat-card.loyalty::before { background: var(--warning); }
        .stat-icon { font-size: 28px; margin-bottom: 8px; }
        .stat-value { font-size: 26px; font-weight: 800; color: var(--navy); }
        .stat-label { font-size: 12px; color: #666; }

        /* Section Card */
        .section-card {
            background: var(--white);
            border-radius: 14px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 18px;
            overflow: hidden;
        }
        .section-header {
            padding: 15px 18px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .section-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--navy);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-gold { background: linear-gradient(135deg, var(--gold), var(--gold-dark)); color: var(--white); }
        .btn-gold:hover { box-shadow: 0 4px 15px rgba(212,175,55,0.4); }
        .btn-success { background: var(--success); color: var(--white); }
        .btn-info { background: var(--info); color: var(--white); }
        .btn-danger { background: var(--error); color: var(--white); }
        .btn-navy { background: var(--navy); color: var(--white); }
        .section-body { padding: 18px; }

        /* Tables */
        .table-container { overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 500px; }
        .data-table th, .data-table td {
            padding: 12px 10px;
            text-align: right;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        .data-table th { background: var(--cream); font-weight: 700; color: var(--navy); }
        .data-table tbody tr:hover { background: var(--cream); }
        .product-cell { display: flex; align-items: center; gap: 10px; }
        .product-img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            color: var(--white);
        }
        .status-pending { background: var(--warning); color: #333; }
        .status-confirmed { background: var(--info); }
        .status-processing { background: #9b59b6; }
        .status-shipped { background: #3498db; }
        .status-delivered { background: var(--success); }
        .status-completed { background: var(--success); }
        .status-cancelled { background: var(--error); }
        .action-btns { display: flex; gap: 5px; }
        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: var(--transition);
        }
        .action-btn:hover { transform: scale(1.1); }
        .action-btn.view { background: rgba(23,162,184,0.15); color: var(--info); }
        .action-btn.edit { background: rgba(212,175,55,0.15); color: var(--gold-dark); }
        .action-btn.delete { background: rgba(220,53,69,0.15); color: var(--error); }

        /* Content Section */
        .content-section { display: none; }
        .content-section.active { display: block; }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 18px;
            margin-bottom: 20px;
        }
        .chart-card {
            background: var(--white);
            border-radius: 14px;
            padding: 18px;
            box-shadow: var(--shadow-sm);
        }
        .chart-title { font-size: 14px; font-weight: 700; color: var(--navy); margin-bottom: 12px; }
        .chart-container { height: 250px; position: relative; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal {
            background: var(--white);
            border-radius: 16px;
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
        }
        .modal.large { max-width: 700px; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header {
            padding: 18px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 10;
        }
        .modal-header h2 { font-size: 18px; color: var(--navy); display: flex; align-items: center; gap: 8px; }
        .close-modal {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--cream);
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }
        .close-modal:hover { background: #ddd; transform: rotate(90deg); }
        .modal-body{
          padding: 18px;
          max-height: 80vh;      /* Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ 80% Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
          overflow-y: auto;      /* ÙØ¹Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
          padding-bottom: 30px;  /* Ù…Ø³Ø§Ø­Ø© ØªØ­Øª Ù„Ù„Ø²Ø± */
}
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 600; color: var(--navy); margin-bottom: 6px; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            font-family: var(--font-arabic);
            transition: var(--transition);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--gold);
            outline: none;
        }
        .form-group textarea { resize: vertical; min-height: 70px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .submit-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }
        .submit-btn:hover { box-shadow: 0 4px 15px rgba(212,175,55,0.4); }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 18px;
        }
        .settings-card {
            background: var(--white);
            border-radius: 14px;
            padding: 18px;
            box-shadow: var(--shadow-sm);
        }
        .settings-card h3 {
            font-size: 15px;
            color: var(--navy);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--cream);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .danger-zone { border: 2px solid var(--error); }
        .danger-zone h3 { color: var(--error); }

        /* Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 18px; flex-wrap: wrap; }
        .tab-btn {
            padding: 10px 18px;
            background: var(--cream);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--navy);
            font-size: 12px;
            transition: var(--transition);
        }
        .tab-btn.active { background: var(--gold); color: var(--white); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Order Details */
        .order-detail-section {
            background: var(--cream);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .order-detail-section h4 {
            font-size: 14px;
            color: var(--navy);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
            font-size: 13px;
        }
        .order-item:last-child { border-bottom: none; }
        .order-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 800;
            color: var(--navy);
            padding-top: 12px;
            border-top: 2px solid var(--gold);
            margin-top: 10px;
        }

        /* Notifications */
        .notifications-container {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 320px;
        }
        .notification {
            background: var(--white);
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.4s ease;
            border-right: 4px solid;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-100%); } to { opacity: 1; transform: translateX(0); } }
        .notification.success { border-right-color: var(--success); }
        .notification.error { border-right-color: var(--error); }
        .notification-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--white);
        }
        .notification.success .notification-icon { background: var(--success); }
        .notification.error .notification-icon { background: var(--error); }
        .notification-content { flex: 1; }
        .notification-title { font-weight: 700; font-size: 12px; color: var(--navy); }
        .notification-message { font-size: 11px; color: #666; }
        .notification-close { background: transparent; border: none; color: #999; font-size: 14px; cursor: pointer; }

        /* Empty State */
        .empty-state { text-align: center; padding: 40px 20px; color: #999; }
        .empty-state-icon { font-size: 50px; margin-bottom: 12px; opacity: 0.5; }

        /* Mobile */
        .mobile-menu-btn {
            display: none;
            background: var(--gold);
            color: var(--white);
            width: 38px;
            height: 38px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .overlay.active { display: block; }

        @media (max-width: 1024px) {
            .mobile-menu-btn { display: flex; align-items: center; justify-content: center; }
            .sidebar { transform: translateX(100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-right: 0; }
        }
        @media (max-width: 768px) {
            .main-content { padding: 12px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .stat-value { font-size: 20px; }
            .form-row, .form-row-3 { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .settings-grid { grid-template-columns: 1fr; }
        }

        /* Status Select */
        .status-select {
            padding: 6px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            background: var(--white);
        }
        .status-select:focus { border-color: var(--gold); outline: none; }

        /* Color Input */
        input[type="color"] {
            width: 50px;
            height: 35px;
            padding: 2px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Loyalty Cards */
        .loyalty-card {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 14px;
            padding: 20px;
            color: var(--white);
            text-align: center;
            margin-bottom: 15px;
        }
        .loyalty-value { font-size: 36px; font-weight: 800; }
        .loyalty-label { font-size: 13px; opacity: 0.9; }

        .user-points-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--cream);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .user-points-info { display: flex; align-items: center; gap: 10px; }
        .user-points-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: var(--navy);
            color: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        .user-points-actions { display: flex; gap: 6px; }
        .points-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }
        .points-btn.add { background: var(--success); color: white; }
        .points-btn.sub { background: var(--error); color: white; }
    </style>
</head>
<body>
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- Login -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">ğŸ”</div>
            <h1 class="login-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <p class="login-subtitle">Sale Zone Store</p>
            <div class="login-error" id="loginError">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="adminEmail" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                </div>
                <div class="form-group">
                    <label>ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="adminPassword" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button type="submit" class="login-btn">Ø¯Ø®ÙˆÙ„</button>
            </form>
            <a href="index.html" class="back-link">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</a>
            <a href="Ù…ØªØ¬Ø±_2.HTML" class="back-link" style="margin-right: 20px;">ğŸ›ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±</a>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">Sale Zone</div>
                <div class="sidebar-subtitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                    <button class="menu-item active" onclick="showSection('overview')">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
                    <button class="menu-item" onclick="showSection('products')">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <span class="badge" id="productsCount">0</span></button>
                    <button class="menu-item" onclick="showSection('orders')">ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª <span class="badge" id="ordersCount">0</span></button>
                    <button class="menu-item" onclick="showSection('banners')">ğŸ  Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª</button>
                    <button class="menu-item" onclick="showSection('coupons')">ğŸ« Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</button>
                    <button class="menu-item" onclick="showSection('users')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
                    <button class="menu-item" onclick="showSection('loyalty')">ğŸ’ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</button>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                    <button class="menu-item" onclick="showSection('reports')">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    <button class="menu-item" onclick="showSection('storeSettings')">ğŸª Ø§Ù„Ù…ØªØ¬Ø±</button>
                    <button class="menu-item" onclick="showSection('settings')">âš™ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                    <a href="Ù…ØªØ¬Ø±_2.HTML" class="menu-item">ğŸ›ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±</a>
                    <a href="index.html" class="menu-item">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                </div>
            </nav>
        </aside>

        <!-- Main -->
        <main class="main-content">
            <div class="top-bar">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
                    <h1 class="page-title" id="pageTitle">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h1>
                </div>
                <div class="top-bar-actions">
                    <div class="admin-info">
                        <div class="admin-avatar">Ù…</div>
                        <span>Ø§Ù„Ù…Ø¯ÙŠØ±</span>
                    </div>
                    <button class="logout-btn" onclick="adminLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            <!-- Overview -->
            <section class="content-section active" id="overviewSection">
                <div class="stats-grid">
                    <div class="stat-card products">
                        <div class="stat-icon">ğŸ“¦</div>
                        <div class="stat-value" id="statProducts">0</div>
                        <div class="stat-label">Ù…Ù†ØªØ¬</div>
                    </div>
                    <div class="stat-card orders">
                        <div class="stat-icon">ğŸ›ï¸</div>
                        <div class="stat-value" id="statOrders">0</div>
                        <div class="stat-label">Ø·Ù„Ø¨</div>
                    </div>
                    <div class="stat-card users">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-value" id="statUsers">0</div>
                        <div class="stat-label">Ø¹Ù…ÙŠÙ„</div>
                    </div>
                    <div class="stat-card revenue">
                        <div class="stat-icon">ğŸ’°</div>
                        <div class="stat-value" id="statRevenue">0</div>
                        <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø¬.Ù…)</div>
                    </div>
                    <div class="stat-card loyalty">
                        <div class="stat-icon">ğŸ’</div>
                        <div class="stat-value" id="statLoyalty">0</div>
                        <div class="stat-label">Ù†Ù‚Ø§Ø· ÙˆÙ„Ø§Ø¡</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title">ğŸ“ˆ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                        <div class="chart-container"><canvas id="salesChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">ğŸ“Š Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
                        <div class="chart-container"><canvas id="categoriesChart"></canvas></div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ• Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                        <button class="btn btn-gold" onclick="showSection('orders')">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø±Ù‚Ù…</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                                <tbody id="recentOrdersTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products -->
            <section class="content-section" id="productsSection">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <div class="header-actions">
                            <button class="btn btn-gold" onclick="openModal('productModal')">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="btn btn-success" onclick="exportProductsExcel()">ğŸ“¤ Excel</button>
                            <input type="file" id="importProductsFile" accept=".xlsx,.xls" onchange="importProductsExcel(event)" style="display:none">
                            <button class="btn btn-info" onclick="document.getElementById('importProductsFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                                <tbody id="productsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders -->
            <section class="content-section" id="ordersSection">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                        <div class="header-actions">
                            <button class="btn btn-success" onclick="exportOrdersExcel()">ğŸ“¤ Excel</button>
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø±Ù‚Ù…</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                                <tbody id="ordersTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Banners -->
            <section class="content-section" id="bannersSection">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ  Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª</h3>
                        <button class="btn btn-gold" onclick="openModal('bannerModal')">â• Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø£ÙŠÙ‚ÙˆÙ†Ø©</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù†Øµ</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                                <tbody id="bannersTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Coupons -->
            <section class="content-section" id="couponsSection">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ« Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</h3>
                        <div class="header-actions">
                            <button class="btn btn-gold" onclick="openModal('couponModal')">â• Ø¥Ø¶Ø§ÙØ©</button>
                            <button class="btn btn-success" onclick="exportCouponsExcel()">ğŸ“¤ Excel</button>
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                                <tbody id="couponsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users -->
            <section class="content-section" id="usersSection">
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                        <button class="btn btn-success" onclick="exportUsersExcel()">ğŸ“¤ Excel</button>
                    </div>
                    <div class="section-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr></thead>
                                <tbody id="usersTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loyalty -->
            <section class="content-section" id="loyaltySection">
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="loyalty-card">
                        <div class="loyalty-value" id="totalLoyalty">0</div>
                        <div class="loyalty-label">ğŸ’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                    </div>
                    <div class="loyalty-card" style="background: linear-gradient(135deg, var(--burgundy), #a00030);">
                        <div class="loyalty-value" id="loyaltyRate">5</div>
                        <div class="loyalty-label">% Ù†Ø³Ø¨Ø© Ø§Ù„Ø§ÙƒØªØ³Ø§Ø¨</div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ„Ø§Ø¡</h3>
                    </div>
                    <div class="section-body">
                        <form onsubmit="saveLoyaltySettings(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§ÙƒØªØ³Ø§Ø¨ (%)</label>
                                    <input type="number" id="loyaltyRateInput" min="1" max="50" value="5">
                                </div>
                                <div class="form-group">
                                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø·Ø© (Ø¬.Ù…)</label>
                                    <input type="number" id="pointValueInput" min="0.01" step="0.01" value="0.1">
                                </div>
                            </div>
                            <button type="submit" class="submit-btn" style="max-width: 200px;">ğŸ’¾ Ø­ÙØ¸</button>
                        </form>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">ğŸ‘¥ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                        <button class="btn btn-gold" onclick="openModal('pointsModal')">â• Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·</button>
                    </div>
                    <div class="section-body" id="loyaltyUsersList"></div>
                </div>
            </section>

            <!-- Reports -->
            <section class="content-section" id="reportsSection">
                <div class="settings-grid">
                    <div class="section-card">
                        <div class="section-header"><h3 class="section-title">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3></div>
                        <div class="section-body">
                            <p style="color: #666; margin-bottom: 12px; font-size: 13px;">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                            <button class="btn btn-success" onclick="exportProductsExcel()" style="width: 100%;">ğŸ“¤ Excel</button>
                        </div>
                    </div>
                    <div class="section-card">
                        <div class="section-header"><h3 class="section-title">ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3></div>
                        <div class="section-body">
                            <p style="color: #666; margin-bottom: 12px; font-size: 13px;">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                            <button class="btn btn-success" onclick="exportOrdersExcel()" style="width: 100%;">ğŸ“¤ Excel</button>
                        </div>
                    </div>
                    <div class="section-card">
                        <div class="section-header"><h3 class="section-title">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3></div>
                        <div class="section-body">
                            <p style="color: #666; margin-bottom: 12px; font-size: 13px;">ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                            <button class="btn btn-success" onclick="exportUsersExcel()" style="width: 100%;">ğŸ“¤ Excel</button>
                        </div>
                    </div>
                    <div class="section-card">
                        <div class="section-header"><h3 class="section-title">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</h3></div>
                        <div class="section-body">
                            <p style="color: #666; margin-bottom: 12px; font-size: 13px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                            <button class="btn btn-success" onclick="exportFullReport()" style="width: 100%;">ğŸ“¤ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Store Settings -->
            <section class="content-section" id="storeSettingsSection">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('general')">âš™ï¸ Ø¹Ø§Ù…</button>
                    <button class="tab-btn" onclick="switchTab('topbar')">ğŸ“¢ Ø§Ù„Ø´Ø±ÙŠØ·</button>
                    <button class="tab-btn" onclick="switchTab('footer')">ğŸ¦¶ Ø§Ù„ÙÙˆØªØ±</button>
                    <button class="tab-btn" onclick="switchTab('contact')">ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„</button>
                </div>

                <div class="tab-content active" id="generalTab">
                    <div class="section-card">
                        <div class="section-body">
                            <form onsubmit="saveGeneralSettings(event)">
                                <div class="form-group">
                                    <label>ğŸª Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
                                    <input type="text" id="storeName" placeholder="Sale Zone Store">
                                </div>
                                <div class="form-group">
                                    <label>ğŸ’¬ Ø§Ù„Ø´Ø¹Ø§Ø±</label>
                                    <input type="text" id="storeTagline" placeholder="Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ÙØ§Ø®Ø± Ø§Ù„Ø°ÙƒÙŠ">
                                </div>
                                <div class="form-group">
                                    <label>ğŸ“ Ø§Ù„ÙˆØµÙ</label>
                                    <textarea id="storeDescription"></textarea>
                                </div>
                                <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="topbarTab">
                    <div class="section-card">
                        <div class="section-body">
                            <form onsubmit="saveTopBarSettings(event)">
                                <div class="form-group">
                                    <label>ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ</label>
                                    <textarea id="topBarText" rows="2"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>ğŸ¨ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                                        <input type="color" id="topBarBgColor" value="#0A1128">
                                    </div>
                                    <div class="form-group">
                                        <label>ğŸ¨ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ</label>
                                        <input type="color" id="topBarTextColor" value="#F4E4BC">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" id="topBarEnabled" checked> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ·</label>
                                </div>
                                <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="footerTab">
                    <div class="section-card">
                        <div class="section-body">
                            <form onsubmit="saveFooterSettings(event)">
                                <div class="form-group">
                                    <label>ğŸ“– Ø¹Ù† Ø§Ù„Ù…ØªØ¬Ø±</label>
                                    <textarea id="footerAbout" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>â° Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                                    <input type="text" id="workingHoursWeekdays" placeholder="Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø®Ù…ÙŠØ³: 9 Øµ - 10 Ù…">
                                </div>
                                <div class="form-group">
                                    <label>â° Ø§Ù„Ø¬Ù…Ø¹Ø©</label>
                                    <input type="text" id="workingHoursFriday" placeholder="Ø§Ù„Ø¬Ù…Ø¹Ø©: 2 Ù… - 10 Ù…">
                                </div>
                                <div class="form-group">
                                    <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                                    <input type="text" id="workingHoursNote" placeholder="ğŸ”” Ø®Ø¯Ù…Ø© 24/7">
                                </div>
                                <div class="form-group">
                                    <label>Â©ï¸ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø±</label>
                                    <input type="text" id="copyrightText">
                                </div>
                                <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="contactTab">
                    <div class="section-card">
                        <div class="section-body">
                            <form onsubmit="saveContactSettings(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ</label>
                                        <input type="tel" id="contactPhone" placeholder="01018108979">
                                    </div>
                                    <div class="form-group">
                                        <label>ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</label>
                                        <input type="tel" id="contactWhatsapp" placeholder="01018108979">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
                                        <input type="email" id="contactEmail">
                                    </div>
                                    <div class="form-group">
                                        <label>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                                        <input type="text" id="contactAddress">
                                    </div>
                                </div>
                                <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Settings -->
            <section class="content-section" id="settingsSection">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                        <form onsubmit="changeAdminPassword(event)">
                            <div class="form-group">
                                <label>Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                                <input type="password" id="currentAdminPass" required>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                                <input type="password" id="newAdminPass" required>
                            </div>
                            <div class="form-group">
                                <label>ØªØ£ÙƒÙŠØ¯</label>
                                <input type="password" id="confirmAdminPass" required>
                            </div>
                            <button type="submit" class="submit-btn">ğŸ”‘ ØªØºÙŠÙŠØ±</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                        <button class="btn btn-gold" onclick="exportAllDataJSON()" style="width: 100%; margin-bottom: 10px;">ğŸ“¤ ØªØµØ¯ÙŠØ± JSON</button>
                        <input type="file" id="importJSONFile" accept=".json" onchange="importAllDataJSON(event)" style="display:none">
                        <button class="btn btn-info" onclick="document.getElementById('importJSONFile').click()" style="width: 100%;">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
                    </div>

                    <div class="settings-card">
                        <h3>ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</h3>
                        <p style="color: #666; margin-bottom: 15px; font-size: 12px;">
                            Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ù„ØµÙˆØ± Ø¨Ù€ Placeholders Ù…Ø­Ù„ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ ORB/CORS.
                        </p>
                        <button class="btn btn-gold" onclick="sanitizeAllImages()" style="width: 100%;">âœ… ØªÙ†Ø¸ÙŠÙ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¨Ø§Ù†Ø±Ø§Øª</button>
                    </div>

                    <div class="settings-card danger-zone">
                        <h3>âš ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h3>
                        <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª!</p>
                        <button class="btn btn-danger" onclick="clearAllData()" style="width: 100%;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Product Modal -->
<div class="modal-overlay" id="productModal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="productModalTitle">â• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
      <button class="close-modal" onclick="closeModal('productModal')">âœ•</button>
    </div>

    <div class="modal-body">
      <form onsubmit="saveProduct(event)">
        <input type="hidden" id="productId">

        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
          <input type="text" id="productName" required>
        </div>

        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ *</label>
          <textarea id="productDesc" required></textarea>
        </div>

        <div class="form-group">
          <label>Ø§Ù„Ù‚Ø³Ù… *</label>
          <select id="productCategory" required>
            <option value="">Ø§Ø®ØªØ±</option>
            <option value="hair-care">ğŸ’‡â€â™€ï¸ Ø´Ø¹Ø±</option>
            <option value="skin-care">ğŸ§´ Ø¨Ø´Ø±Ø©</option>
            <option value="baby-care">ğŸ‘¶ Ø·ÙÙ„</option>
            <option value="supplements">ğŸ’Š Ù…ÙƒÙ…Ù„Ø§Øª</option>
            <option value="medical">ğŸ¥ Ø·Ø¨ÙŠ</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Ø§Ù„Ø³Ø¹Ø± *</label>
            <input type="number" id="productPrice" required min="0">
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…</label>
            <input type="number" id="productOldPrice" min="0">
          </div>
        </div>

        <!-- ============ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø±ÙØ¹ Ø£Ùˆ Ø±Ø§Ø¨Ø·) ============ -->
        <div class="form-group">
          <label>ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>

          <!-- Ø±ÙØ¹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² -->
          <input type="file" id="imgFile" accept="image/*" style="display:none" onchange="uploadAndPreview(this)">
          <button type="button"
                  onclick="document.getElementById('imgFile').click()"
                  style="background:#D4AF37;color:white;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;">
            ğŸ“ Ø±ÙØ¹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
          </button>

          <div id="imgPreview" style="margin-top:10px;"></div>

          <!-- Ø£Ùˆ Ø±Ø§Ø¨Ø· -->
          <div style="margin:10px 0;color:#999;text-align:center;">â€” Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· â€”</div>
          <input type="url" id="manualImg" placeholder="https://..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;direction:ltr;">

          <!-- Ø±Ø§Ø¨Ø· Ù†Ù‡Ø§Ø¦ÙŠ (ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹) -->
          <input type="hidden" id="finalImg" required>
        </div>
        <!-- =================================================== -->

        <!-- Ø²Ø± Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† Ù†Ø§Ù‚Øµ) -->
        <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #eee; text-align: center;">
          <button type="submit" class="submit-btn" style="min-width: 220px; font-size: 16px; font-weight: bold;">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

    <!-- Banner Modal -->
    <div class="modal-overlay" id="bannerModal">
        <div class="modal">
            <div class="modal-header">
                <h2>â• Ø¨Ø§Ù†Ø± Ø¬Ø¯ÙŠØ¯</h2>
                <button class="close-modal" onclick="closeModal('bannerModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveBanner(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                            <input type="text" id="bannerIcon" placeholder="ğŸ‰">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚Ø³Ù…</label>
                            <select id="bannerCategory">
                                <option value="all">Ø§Ù„ÙƒÙ„</option>
                                <option value="hair-care">Ø´Ø¹Ø±</option>
                                <option value="skin-care">Ø¨Ø´Ø±Ø©</option>
                                <option value="baby-care">Ø·ÙÙ„</option>
                                <option value="supplements">Ù…ÙƒÙ…Ù„Ø§Øª</option>
                                <option value="medical">Ø·Ø¨ÙŠ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
                        <input type="text" id="bannerTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù†Øµ</label>
                        <input type="text" id="bannerText">
                    </div>
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø²Ø±</label>
                        <input type="text" id="bannerBtn" placeholder="ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†">
                    </div>
                    <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Coupon Modal -->
    <div class="modal-overlay" id="couponModal">
        <div class="modal">
            <div class="modal-header">
                <h2>â• ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</h2>
                <button class="close-modal" onclick="closeModal('couponModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveCoupon(event)">
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙˆØ¯ *</label>
                        <input type="text" id="couponCode" required style="text-transform: uppercase;">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ *</label>
                        <input type="text" id="couponDesc" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ù†ÙˆØ¹ *</label>
                            <select id="couponType" required>
                                <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                                <option value="fixed">Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚ÙŠÙ…Ø© *</label>
                            <input type="number" id="couponValue" required min="1">
                        </div>
                    </div>
                    <button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal large">
            <div class="modal-header">
                <h2>ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                <button class="close-modal" onclick="closeModal('orderModal')">âœ•</button>
            </div>
            <div class="modal-body" id="orderModalBody"></div>
        </div>
    </div>

    <!-- Points Modal -->
    <div class="modal-overlay" id="pointsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ’ Ø¥Ø¶Ø§ÙØ©/Ø®ØµÙ… Ù†Ù‚Ø§Ø·</h2>
                <button class="close-modal" onclick="closeModal('pointsModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form onsubmit="handlePointsAction(event)">
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
                        <select id="pointsUserId" required></select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù…Ù„ÙŠØ© *</label>
                            <select id="pointsAction" required>
                                <option value="add">â• Ø¥Ø¶Ø§ÙØ©</option>
                                <option value="subtract">â– Ø®ØµÙ…</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù†Ù‚Ø§Ø· *</label>
                            <input type="number" id="pointsAmount" required min="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ø¨Ø¨</label>
                        <input type="text" id="pointsReason">
                    </div>
                    <button type="submit" class="submit-btn">âœ… ØªÙ†ÙÙŠØ°</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        // ============================================
        // Data Store
        // ============================================
        let products = [];
        let orders = [];
        let coupons = [];
        let banners = [];
        let users = [];
        // ğŸ” ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù…Ø§Ù†: ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
        // âš ï¸ ÙŠÙÙ†ØµØ­ Ø¨ØªØºÙŠÙŠØ±Ù‡Ø§ ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        let adminPassword = null;
        let storeSettings = {
            name: 'Sale Zone Store',
            tagline: 'Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ÙØ§Ø®Ø± Ø§Ù„Ø°ÙƒÙŠ',
            description: '',
            topBar: { enabled: true, text: 'ğŸ‰ Ø®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ©!', bgColor: '#0A1128', textColor: '#F4E4BC' },
            contact: { phone: '01018108979', whatsapp: '01018108979', email: 'info@salezone.com', address: 'Ù…ØµØ±' },
            footer: { about: '', workingHoursWeekdays: 'Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø®Ù…ÙŠØ³: 9 Øµ - 10 Ù…', workingHoursFriday: 'Ø§Ù„Ø¬Ù…Ø¹Ø©: 2 Ù… - 10 Ù…', workingHoursNote: 'ğŸ”” Ø®Ø¯Ù…Ø© 24/7', copyright: 'Â© 2026 Sale Zone Store â¤ï¸' },
            loyalty: { rate: 5, pointValue: 0.1 }
        };
        let salesChart, categoriesChart;

        // ============================================
        // Initialize
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAdminSession();
        });

        // ============================================
        // Data Management
        // ============================================
        // ğŸ”¥ Firebase + LocalStorage Hybrid Data Loading
        async function loadAllData() {
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase Ø£ÙˆÙ„Ø§Ù‹
                if (typeof getAllProducts === 'function') {
                    console.log('ğŸ”¥ Admin: Loading from Firebase...');
                    
                    products = await getAllProducts() || [];
                    orders = await getAllOrders() || [];
                    users = await getAllUsers() || [];
                    coupons = await getAllCoupons() || [];
                    banners = await getAllBanners() || [];
                    
                    const settings = await getSettings();
                    if (settings) storeSettings = { ...storeSettings, ...settings };
                    
                    console.log('âœ… Admin data loaded from Firebase');
                    console.log('ğŸ“¦ Products:', products.length);
                    console.log('ğŸ“¦ Product IDs:', products.map(p => p.id));
                    console.log('ğŸ›ï¸ Orders:', orders.length);
                } else {
                    throw new Error('Firebase not available');
                }
            } catch (error) {
                console.warn('âš ï¸ Firebase error, using localStorage:', error);
                // Fallback to localStorage
                products = getStorageData('PRODUCTS') || [];
                orders = getStorageData('ORDERS') || [];
                coupons = getStorageData('COUPONS') || [];
                banners = getStorageData('BANNERS') || [];
                users = getStorageData('CUSTOMERS') || [];
            }
            
            // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù† localStorage
            const saved = getStorageData('SETTINGS');
            if (saved) storeSettings = { ...storeSettings, ...saved };
            
            // Data loaded, rendering will be done by initDashboard()
        }

        function saveProducts() { setStorageData('PRODUCTS', products); }
        function saveOrders() { setStorageData('ORDERS', orders); }
        function saveCoupons() { setStorageData('COUPONS', coupons); }
        function saveBanners() { setStorageData('BANNERS', banners); }
        function saveUsers() { setStorageData('CUSTOMERS', users); }
        function saveAdminPassword() {}
        function saveStoreSettings() { setStorageData('SETTINGS', storeSettings); }

        // ============================================
        // Auth
        // ============================================
        const ADMIN_EMAIL = "ahmed.sheta89@gmail.com";
        const ALLOW_BOOTSTRAP_ADMIN = true; // Temporary until custom claims are set

        async function handleLogin(e){
  e.preventDefault();
  const email = document.getElementById('adminEmail').value.trim();
  const pass = document.getElementById('adminPassword').value;
  const loginError = document.getElementById('loginError');

  // Rate limiting check
  const clientIP = 'client_' + Math.random().toString(36).substr(2, 9);
  if (rateLimiter.isBlocked(clientIP)) {
    const blockTime = Math.ceil(rateLimiter.getBlockTimeRemaining(clientIP) / 60000);
    loginError.style.display = 'block';
    loginError.textContent = `ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ${blockTime} Ø¯Ù‚ÙŠÙ‚Ø©`;
    return;
  }

  try{
    const userCred = await firebase.auth().signInWithEmailAndPassword(email, pass);
    const token = await userCred.user.getIdTokenResult(true);
    const isAdmin = token?.claims?.admin === true;
    const isBootstrapAdmin = ALLOW_BOOTSTRAP_ADMIN && userCred.user.email === ADMIN_EMAIL;

    if (!isAdmin && !isBootstrapAdmin) {
      await firebase.auth().signOut();
      rateLimiter.recordAttempt(clientIP);
      const remaining = rateLimiter.getRemainingAttempts(clientIP);
      loginError.style.display = 'block';
      loginError.textContent = `ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„. Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©: ${remaining}`;
      return;
    }

    // Reset rate limiting on successful login
    rateLimiter.attempts.delete(clientIP);
    
    // Create secure session
    const sessionId = sessionManager.createSession(userCred.user.uid, { 
      role: 'admin', 
      loginTime: new Date().toISOString() 
    });
    
    sessionStorage.setItem('adminLoggedIn', 'true');
    sessionStorage.setItem('adminSessionId', sessionId);
    
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('dashboard').classList.add('active');

    await loadAllData();
    initDashboard();
    
    if (!isAdmin && isBootstrapAdmin) {
      showNotification('info', 'ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ', 'Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ… Ø¨ÙˆØ¶Ø¹ Ù…Ø¤Ù‚Øª. ÙØ¹Ù‘Ù„ Custom Claims Ø«Ù… Ø¹Ø·Ù‘Ù„ ALLOW_BOOTSTRAP_ADMIN.');
    } else {
      showNotification('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    }

  }catch(err){
    console.error('Login error:', err);
    rateLimiter.recordAttempt(clientIP);
    const remaining = rateLimiter.getRemainingAttempts(clientIP);
    loginError.style.display='block';
    loginError.textContent = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©: ${remaining}`;
  }
}

       function checkAdminSession() {
  if (typeof firebase !== 'undefined' && firebase.auth) {
    firebase.auth().onAuthStateChanged(async (user) => {
      if (!user) {
        sessionStorage.removeItem('adminLoggedIn');
        sessionStorage.removeItem('adminSessionId');
        sessionStorage.removeItem('adminSession');
        document.getElementById('dashboard').classList.remove('active');
        document.getElementById('loginScreen').style.display = 'flex';
        return;
      }

      const token = await user.getIdTokenResult();
      const isAdmin = token?.claims?.admin === true;
      const isBootstrapAdmin = ALLOW_BOOTSTRAP_ADMIN && user.email === ADMIN_EMAIL;
      if (isAdmin || isBootstrapAdmin) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('dashboard').classList.add('active');
        if (!products.length) {
          loadAllData().then(initDashboard);
        }
      } else {
        await firebase.auth().signOut();
      }
    });
    return;
  }

  // Fallback: no Firebase
  document.getElementById('dashboard').classList.remove('active');
  document.getElementById('loginScreen').style.display = 'flex';
}

function adminLogout(){
  const sessionId = sessionStorage.getItem('adminSessionId');
  if (sessionId) {
    sessionManager.destroySession(sessionId);
  }
  
  sessionStorage.removeItem('adminLoggedIn');
  sessionStorage.removeItem('adminSessionId');
  sessionStorage.removeItem('adminSession');
  
  // Clear Firebase auth if used
  if (typeof firebase !== 'undefined' && firebase.auth()) {
    firebase.auth().signOut();
  }
  
  showNotification('info', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
  location.reload();
}

        // ============================================
        // Dashboard
        // ============================================
        function initDashboard() {
            updateStats();
            updateBadges();
            renderProductsTable();
            renderOrdersTable();
            renderBannersTable();
            renderCouponsTable();
            renderUsersTable();
            renderRecentOrders();
            renderLoyaltySection();
            loadSettingsToForms();
            initCharts();
        }

        function updateStats() {
            document.getElementById('statProducts').textContent = products.length;
            document.getElementById('statOrders').textContent = orders.length;
            document.getElementById('statUsers').textContent = users.length;
            document.getElementById('statRevenue').textContent = orders.reduce((s, o) => s + (o.total || 0), 0).toLocaleString();
            document.getElementById('statLoyalty').textContent = users.reduce((s, u) => s + (u.loyaltyPoints || 0), 0);
        }

        function updateBadges() {
            document.getElementById('productsCount').textContent = products.length;
            document.getElementById('ordersCount').textContent = orders.filter(o => o.status === 'pending').length;
        }

        // ============================================
        // Products
        // ============================================
        function sanitizeImageUrl(url) {
            const placeholder = './assets/placeholder.svg';
            if (!url || typeof url !== 'string') return placeholder;

            const trimmed = url.trim();
            if (trimmed.startsWith('data:')) return trimmed;
            if (trimmed.startsWith('./') || trimmed.startsWith('assets/')) return trimmed;

            try {
                const parsed = new URL(trimmed, window.location.origin);
                if (parsed.origin === window.location.origin) {
                    return parsed.pathname + parsed.search + parsed.hash;
                }
            } catch (e) {
                return placeholder;
            }

            return placeholder;
        }

        function renderProductsTable() {
            const tbody = document.getElementById('productsTable');
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">ğŸ“¦</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = products.map(p => `
                <tr>
                    <td><div class="product-cell"><img src="${sanitizeImageUrl(p.image)}" class="product-img" onerror="this.src='${sanitizeImageUrl('')}'"><div><strong>${p.name}</strong></div></div></td>
                    <td>${getCategoryName(p.category)}</td>
                    <td><strong>${p.price} Ø¬.Ù…</strong></td>
                    <td>â­ ${(p.rating || 0).toFixed(1)}</td>
                    <td><div class="action-btns"><button class="action-btn edit" onclick="editProduct('${p.id}')">âœï¸</button><button class="action-btn delete" onclick="deleteProduct('${p.id}')">ğŸ—‘ï¸</button></div></td>
                </tr>
            `).join('');
        }

        // ============================================
        // Bulk sanitize external images (professional fix)
        // ============================================
        function isExternalImageUrl(url) {
            if (!url || typeof url !== 'string') return false;
            const trimmed = url.trim();
            if (trimmed.startsWith('data:')) return false;
            if (trimmed.startsWith('./') || trimmed.startsWith('assets/')) return false;
            try {
                const parsed = new URL(trimmed, window.location.origin);
                return parsed.origin !== window.location.origin;
            } catch (e) {
                return false;
            }
        }

        async function sanitizeAllImages() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙƒÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø¨Ø¨Ø¯Ø§Ø¦Ù„ Ù…Ø­Ù„ÙŠØ©ØŸ')) return;

            const productPlaceholder = './assets/placeholder.svg';
            const bannerPlaceholder = './assets/banner-placeholder.svg';

            let productsUpdated = 0;
            let bannersUpdated = 0;

            // Update products
            products = products.map(p => {
                if (isExternalImageUrl(p.image)) {
                    productsUpdated += 1;
                    return { ...p, image: productPlaceholder };
                }
                return p;
            });

            // Update banners (if banners are used in admin data)
            if (Array.isArray(banners)) {
                banners = banners.map(b => {
                    if (isExternalImageUrl(b.image)) {
                        bannersUpdated += 1;
                        return { ...b, image: bannerPlaceholder };
                    }
                    return b;
                });
            }

            // Persist locally
            if (typeof saveProducts === 'function') saveProducts();
            if (typeof saveBanners === 'function') saveBanners();

            // Update Firebase if available
            try {
                if (typeof updateProduct === 'function') {
                    for (const p of products) {
                        if (p.id && p.image === productPlaceholder) {
                            await updateProduct(p.id, { image: p.image });
                        }
                    }
                }
                if (typeof updateBanner === 'function') {
                    for (const b of banners) {
                        if (b.id && b.image === bannerPlaceholder) {
                            await updateBanner(b.id, { image: b.image });
                        }
                    }
                }
            } catch (e) {
                console.warn('Firebase update skipped or failed:', e);
            }

            renderProductsTable();
            renderBannersTable();
            showNotification('success', 'ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙˆØ±', `ØªÙ… ØªØ­Ø¯ÙŠØ« ${productsUpdated} Ù…Ù†ØªØ¬ Ùˆ ${bannersUpdated} Ø¨Ø§Ù†Ø±`);
        }

        function getCategoryName(cat) {
            const names = { 'hair-care': 'Ø´Ø¹Ø±', 'skin-care': 'Ø¨Ø´Ø±Ø©', 'baby-care': 'Ø·ÙÙ„', 'supplements': 'Ù…ÙƒÙ…Ù„Ø§Øª', 'medical': 'Ø·Ø¨ÙŠ' };
            return names[cat] || cat;
        }

        async function saveProduct(e) {
            e.preventDefault();
            const id = document.getElementById('productId').value.trim();
            const imageUrl = document.getElementById('finalImg').value || document.getElementById('manualImg').value;
            if (!imageUrl) {
        showNotification('error', 'âŒ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø©', 'ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø·');
        return;
    }
    
    const data = {
        name: document.getElementById('productName').value.trim(),
        desc: document.getElementById('productDesc').value.trim(),
        category: document.getElementById('productCategory').value,
        price: parseFloat(document.getElementById('productPrice').value),
        oldPrice: parseFloat(document.getElementById('productOldPrice').value) || null,
        image: imageUrl, // â† Ù‡Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
        rating: 4.5,
        ratingCount: 0
    };
            try {
                if (id) {
                    // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯
                    const idx = products.findIndex(p => String(p.id) === String(id));
                    if (idx !== -1) {
                        products[idx] = { ...products[idx], ...data };
                        if (typeof updateProduct === 'function') {
                            await updateProduct(id, { ...products[idx] });
                        }
                    }
                    showNotification('success', 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…');
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                    if (typeof addProduct === 'function') {
                        const firebaseId = await addProduct(data);
                        data.id = firebaseId;
                    } else {
                        data.id = Date.now().toString();
                    }
                    products.push(data);
                    showNotification('success', 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…');
                }
            } catch (error) {
                console.error('Firebase save error:', error);
                if (!id) data.id = Date.now().toString();
                if (id) {
                    const idx = products.findIndex(p => String(p.id) === String(id));
                    if (idx !== -1) products[idx] = { ...products[idx], ...data };
                } else {
                    products.push(data);
                }
                showNotification('success', 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© (Ù…Ø­Ù„ÙŠØ§Ù‹) âœ…');
            }
            saveProducts();
            renderProductsTable();
            updateStats();
            closeModal('productModal');
            resetProductForm();
        }

        function editProduct(id) {
  const p = products.find(x => String(x.id) === String(id));
  if (!p) return;

  document.getElementById('productId').value = p.id || '';
  document.getElementById('productName').value = p.name || '';
  document.getElementById('productDesc').value = p.desc || '';
  document.getElementById('productCategory').value = p.category || '';
  document.getElementById('productPrice').value = p.price ?? '';
  document.getElementById('productOldPrice').value = p.oldPrice ?? '';

  // âœ… Ø§Ù„ØµÙˆØ±Ø©
  const img = p.image || '';
  document.getElementById('finalImg').value = img;
  document.getElementById('manualImg').value = img;

  // âœ… Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  const preview = document.getElementById('imgPreview');
  if (preview) {
    const safeImg = img ? sanitizeImageUrl(img) : '';
    preview.innerHTML = safeImg
      ? `<img src="${safeImg}" style="max-width:150px;border-radius:8px;border:2px solid #D4AF37;margin-top:10px;" onerror="this.style.display='none'">`
      : '';
  }

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ØªØµÙÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ø¹Ø´Ø§Ù† Ù„Ùˆ Ù‡ÙŠØ±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
  const fileInput = document.getElementById('imgFile');
  if (fileInput) fileInput.value = '';

  document.getElementById('productModalTitle').textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„';
  openModal('productModal');
}

        async function deleteProduct(id) {
            if (!confirm('Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
            try {
                if (typeof deleteProductFromFirebase === 'function') {
                    await deleteProductFromFirebase(id);
                }
            } catch (error) {
                console.error('Firebase delete error:', error);
            }
            products = products.filter(p => p.id != id && String(p.id) != String(id));
            saveProducts();
            renderProductsTable();
            updateStats();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…');
        }

        function resetProductForm() {
  // IDs Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  const idsToClear = [
    'productId',
    'productName',
    'productDesc',
    'productCategory',
    'productPrice',
    'productOldPrice',

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯
    'manualImg',
    'finalImg',
    'imgFile'
  ];

  idsToClear.forEach((id) => {
    const el = document.getElementById(id);
    if (!el) return; // âœ… Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø§ Ù†Ø¹Ù…Ù„Ø´ Ø®Ø·Ø£

    if (el.type === 'file') el.value = '';
    else el.value = '';
  });

  // Ù…Ø³Ø­ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
  const preview = document.getElementById('imgPreview');
  if (preview) preview.innerHTML = '';

  // (ØªÙˆØ§ÙÙ‚ Ù…Ø¹ IDs Ù‚Ø¯ÙŠÙ…Ø© Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ ÙÙŠ Ø£ÙŠ Ø¬Ø²Ø¡)
  const legacy = ['productImage', 'productImageUrl', 'imagePreviewContainer', 'uploadStatus'];
  legacy.forEach((id) => {
    const el = document.getElementById(id);
    if (!el) return;
    if (el.tagName === 'DIV') el.innerHTML = '';
    else el.value = '';
  });

  // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙŠØ±Ø¬Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  const title = document.getElementById('productModalTitle');
  if (title) title.textContent = 'â• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
}

        // ============================================
        // Orders
        // ============================================
        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTable');
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">ğŸ›ï¸</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = orders.map(o => `
                <tr>
                    <td><strong>${o.orderNumber || o.id}</strong></td>
                    <td>${o.customer?.name || '-'}</td>
                    <td>${o.customer?.phone || '-'}</td>
                    <td><strong>${o.total || 0} Ø¬.Ù…</strong></td>
                    <td><span class="status-badge status-${o.status}">${getStatusName(o.status)}</span></td>
                    <td>${formatDate(o.createdAt)}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn view" onclick="viewOrder(${o.id})">ğŸ‘ï¸</button>
                            <button class="action-btn delete" onclick="deleteOrder('${o.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderRecentOrders() {
            const tbody = document.getElementById('recentOrdersTable');
            const recent = orders.slice(-5).reverse();
            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#999;padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                return;
            }
            tbody.innerHTML = recent.map(o => `
                <tr>
                    <td><strong>${o.orderNumber || o.id}</strong></td>
                    <td>${o.customer?.name || '-'}</td>
                    <td><strong>${o.total || 0} Ø¬.Ù…</strong></td>
                    <td><span class="status-badge status-${o.status}">${getStatusName(o.status)}</span></td>
                    <td>${formatDate(o.createdAt)}</td>
                </tr>
            `).join('');
        }

        function getStatusName(s) {
            const names = { pending: 'Ø¬Ø¯ÙŠØ¯', confirmed: 'Ù…Ø¤ÙƒØ¯', processing: 'ØªØ¬Ù‡ÙŠØ²', shipped: 'Ø´Ø­Ù†', delivered: 'ØªÙˆØµÙŠÙ„', completed: 'Ù…ÙƒØªÙ…Ù„', cancelled: 'Ù…Ù„ØºÙŠ' };
            return names[s] || s;
        }

        function formatDate(d) {
            if (!d) return '-';
            return new Date(d).toLocaleDateString('ar-EG');
        }

        function viewOrder(id) {
            const o = orders.find(x => String(x.id) === String(id));
            if (!o) return;

            let itemsHtml = o.items?.map(i => `
                <div class="order-item">
                    <span>${i.name} Ã— ${i.quantity}</span>
                    <strong>${i.price * i.quantity} Ø¬.Ù…</strong>
                </div>
            `).join('') || '';

            document.getElementById('orderModalBody').innerHTML = `
                <div class="order-detail-section">
                    <h4>ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨</h4>
                    <p><strong>Ø±Ù‚Ù…:</strong> ${o.orderNumber || o.id}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(o.createdAt)}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> 
                        <select class="status-select" onchange="updateOrderStatus(${o.id}, this.value)">
                            <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯</option>
                            <option value="confirmed" ${o.status === 'confirmed' ? 'selected' : ''}>Ù…Ø¤ÙƒØ¯</option>
                            <option value="processing" ${o.status === 'processing' ? 'selected' : ''}>ØªØ¬Ù‡ÙŠØ²</option>
                            <option value="shipped" ${o.status === 'shipped' ? 'selected' : ''}>Ø´Ø­Ù†</option>
                            <option value="delivered" ${o.status === 'delivered' ? 'selected' : ''}>ØªÙˆØµÙŠÙ„</option>
                            <option value="completed" ${o.status === 'completed' ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„</option>
                            <option value="cancelled" ${o.status === 'cancelled' ? 'selected' : ''}>Ù…Ù„ØºÙŠ</option>
                        </select>
                    </p>
                </div>

                <div class="order-detail-section">
                    <h4>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${o.customer?.name}</p>
                    <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${o.customer?.phone}</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${o.customer?.address}</p>
                    ${o.customer?.notes ? `<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${o.customer.notes}</p>` : ''}
                </div>

                <div class="order-detail-section">
                    <h4>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                    ${itemsHtml || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯</p>'}
                    
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid #ddd;">
                        <div class="order-item"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span><span>${o.subtotal || 0} Ø¬.Ù…</span></div>
                        ${o.couponCode ? `<div class="order-item" style="color: var(--success);"><span>ğŸ« ${o.couponCode}</span><span>- ${o.discount || 0} Ø¬.Ù…</span></div>` : ''}
                        ${o.usedPoints > 0 ? `<div class="order-item" style="color: var(--info);"><span>ğŸ’ Ù†Ù‚Ø§Ø· (${o.usedPoints})</span><span>- ${o.pointsDiscount || 0} Ø¬.Ù…</span></div>` : ''}
                        ${o.earnedPoints > 0 ? `<div class="order-item" style="color: var(--burgundy);"><span>â­ Ù†Ù‚Ø§Ø· Ù…ÙƒØªØ³Ø¨Ø©</span><span>+${o.earnedPoints}</span></div>` : ''}
                    </div>
                    <div class="order-total"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span>${o.total || 0} Ø¬.Ù…</span></div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-navy" onclick="printOrder(${o.id})" style="flex: 1;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    <button class="btn btn-success" onclick="sendWhatsAppUpdate(${o.id})" style="flex: 1;">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
                </div>
            `;
            openModal('orderModal');
        }

        function updateOrderStatus(id, status) {
            const o = orders.find(x => String(x.id) === String(id));
            if (!o) return;
            o.status = status;
            if (!o.statusHistory) o.statusHistory = [];
            o.statusHistory.push({ status, date: new Date().toISOString() });
            saveOrders();
            renderOrdersTable();
            renderRecentOrders();
            updateBadges();
            showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
        }

        function sendWhatsAppUpdate(id) {
            const o = orders.find(x => String(x.id) === String(id));
            if (!o) return;
            const phone = o.customer?.phone || '';
            const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${o.customer?.name}!\n\nğŸ“¦ Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù…: ${o.orderNumber}\nğŸ“ Ø§Ù„Ø­Ø§Ù„Ø©: ${getStatusName(o.status)}\n\nØ´ÙƒØ±Ø§Ù‹ Ù„ØªØ³ÙˆÙ‚Ùƒ Ù…Ø¹Ù†Ø§! ğŸ›ï¸`;
            window.open(`https://wa.me/2${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function printOrder(id) {
            const o = orders.find(x => String(x.id) === String(id));
            if (!o) return;
            const w = window.open('', '_blank');
            w.document.write(`
                <!DOCTYPE html>
                <html dir="rtl"><head><title>ÙØ§ØªÙˆØ±Ø© ${o.orderNumber}</title>
                <style>body{font-family:Arial;padding:20px}h1{color:#D4AF37;text-align:center}table{width:100%;border-collapse:collapse;margin:20px 0}th,td{border:1px solid #ddd;padding:10px;text-align:right}th{background:#f5f5f5;font-weight:700;color:#0A1128}.total{font-size:20px;font-weight:bold}</style></head>
                <body>
                <h1>Sale Zone Store</h1>
                <h2>ÙØ§ØªÙˆØ±Ø©: ${o.orderNumber}</h2>
                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(o.createdAt)}</p>
                <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${o.customer?.name}</p>
                <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${o.customer?.phone}</p>
                <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${o.customer?.address}</p>
                <table><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
                ${o.items?.map(i => `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.price}</td><td>${i.price * i.quantity}</td></tr>`).join('')}
                </table>
                <p class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${o.total} Ø¬.Ù…</p>
                <p style="text-align:center">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³ÙˆÙ‚Ùƒ Ù…Ø¹Ù†Ø§! ğŸ“ ${storeSettings.contact?.phone}</p>
                </body></html>
            `);
            w.document.close();
            w.print();
        }

        function deleteOrder(id) {
            if (!confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
            orders = orders.filter(o => String(o.id) !== String(id));
            saveOrders();
            renderOrdersTable();
            renderRecentOrders();
            updateStats();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }

        // ============================================
        // Banners
        // ============================================
        function renderBannersTable() {
            const tbody = document.getElementById('bannersTable');
            if (banners.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">ğŸ </div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù†Ø±Ø§Øª</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = banners.map(b => `
                <tr>
                    <td style="font-size: 24px;">${b.icon || 'ğŸ‰'}</td>
                    <td><strong>${b.title}</strong></td>
                    <td>${b.text || '-'}</td>
                    <td>${getCategoryName(b.category) || 'Ø§Ù„ÙƒÙ„'}</td>
                    <td><button class="action-btn delete" onclick="deleteBanner('${b.id}')">ğŸ—‘ï¸</button></td>
                </tr>
            `).join('');
        }

        async function saveBanner(e) {
            e.preventDefault();
            const data = {
                id: Date.now(),
                icon: document.getElementById('bannerIcon').value || 'ğŸ‰',
                title: document.getElementById('bannerTitle').value.trim(),
                text: document.getElementById('bannerText').value.trim(),
                btn: document.getElementById('bannerBtn').value.trim() || 'ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†',
                category: document.getElementById('bannerCategory').value
            };
            try {
                if (typeof addBanner === 'function') {
                    const firebaseId = await addBanner(data);
                    data.id = firebaseId;
                }
            } catch (error) { console.error('Firebase error:', error); if (!data.id) data.id = Date.now(); }
            banners.push(data);
            saveBanners();
            renderBannersTable();
            closeModal('bannerModal');
            showNotification('success', 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…');
            document.getElementById('bannerIcon').value = '';
            document.getElementById('bannerTitle').value = '';
            document.getElementById('bannerText').value = '';
            document.getElementById('bannerBtn').value = '';
        }

        async function deleteBanner(id) {
            if (!confirm('Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù†Ø±ØŸ')) return;
            try {
                if (typeof deleteBannerFromFirebase === 'function') {
                    await deleteBannerFromFirebase(id);
                }
            } catch (error) { console.error('Firebase delete error:', error); }
            banners = banners.filter(b => String(b.id) !== String(id));
            saveBanners();
            renderBannersTable();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…');
        }

        // ============================================
        // Coupons
        // ============================================
        function renderCouponsTable() {
            const tbody = document.getElementById('couponsTable');
            if (coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">ğŸ«</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = coupons.map(c => `
                <tr>
                    <td><strong style="color: var(--burgundy);">${c.code}</strong></td>
                    <td>${c.desc}</td>
                    <td>${c.type === 'percentage' ? 'Ù†Ø³Ø¨Ø©' : 'Ø«Ø§Ø¨Øª'}</td>
                    <td><strong>${c.value}${c.type === 'percentage' ? '%' : ' Ø¬.Ù…'}</strong></td>
                    <td><button class="action-btn delete" onclick="deleteCoupon('${c.id}')">ğŸ—‘ï¸</button></td>
                </tr>
            `).join('');
        }

        async function saveCoupon(e) {
            e.preventDefault();
            const code = document.getElementById('couponCode').value.trim().toUpperCase();
            if (coupons.find(c => c.code === code)) {
                showNotification('error', 'Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            coupons.push({
                id: Date.now(),
                code,
                desc: document.getElementById('couponDesc').value.trim(),
                type: document.getElementById('couponType').value,
                value: parseFloat(document.getElementById('couponValue').value)
            });
            saveCoupons();
            renderCouponsTable();
            closeModal('couponModal');
            showNotification('success', 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
            document.getElementById('couponCode').value = '';
            document.getElementById('couponDesc').value = '';
            document.getElementById('couponValue').value = '';
        }

        async function deleteCoupon(id) {
            if (!confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†ØŸ')) return;
            try {
                if (typeof deleteCouponFromFirebase === 'function') {
                    await deleteCouponFromFirebase(id);
                }
            } catch (error) { console.error('Firebase delete error:', error); }
            coupons = coupons.filter(c => String(c.id) !== String(id));
            saveCoupons();
            renderCouponsTable();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…');
        }

        // ============================================
        // Users
        // ============================================
        function renderUsersTable() {
            const tbody = document.getElementById('usersTable');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td><strong>${u.name}</strong></td>
                    <td>${u.phone}</td>
                    <td>${u.email || '-'}</td>
                    <td><strong style="color: var(--gold-dark);">${u.loyaltyPoints || 0}</strong></td>
                    <td>${formatDate(u.createdAt)}</td>
                </tr>
            `).join('');
        }

        // ============================================
        // Loyalty
        // ============================================
        function renderLoyaltySection() {
            const total = users.reduce((s, u) => s + (u.loyaltyPoints || 0), 0);
            document.getElementById('totalLoyalty').textContent = total;
            document.getElementById('loyaltyRate').textContent = storeSettings.loyalty?.rate || 5;
            document.getElementById('loyaltyRateInput').value = storeSettings.loyalty?.rate || 5;
            document.getElementById('pointValueInput').value = storeSettings.loyalty?.pointValue || 0.1;

            const list = document.getElementById('loyaltyUsersList');
            const select = document.getElementById('pointsUserId');

            if (users.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</p></div>';
                select.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>';
                return;
            }

            list.innerHTML = users.map(u => `
                <div class="user-points-card">
                    <div class="user-points-info">
                        <div class="user-points-avatar">${u.name.charAt(0)}</div>
                        <div><strong>${u.name}</strong><div style="font-size:11px;color:#666;">${u.phone}</div></div>
                    </div>
                    <strong style="color: var(--gold-dark); font-size: 18px;">${u.loyaltyPoints || 0}</strong>
                    <div class="user-points-actions">
                        <button class="points-btn add" onclick="quickAddPoints(${u.id})">â•</button>
                        <button class="points-btn sub" onclick="quickSubPoints(${u.id})">â–</button>
                    </div>
                </div>
            `).join('');

            select.innerHTML = '<option value="">Ø§Ø®ØªØ±</option>' + users.map(u => `<option value="${u.id}">${u.name} (${u.loyaltyPoints || 0})</option>`).join('');
        }

        function saveLoyaltySettings(e) {
            e.preventDefault();
            storeSettings.loyalty = {
                rate: parseFloat(document.getElementById('loyaltyRateInput').value),
                pointValue: parseFloat(document.getElementById('pointValueInput').value)
            };
            saveStoreSettings();
            renderLoyaltySection();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function quickAddPoints(userId) {
            const pts = prompt('Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·:');
            if (pts && !isNaN(pts)) {
                const u = users.find(x => x.id === userId);
                if (u) {
                    u.loyaltyPoints = (u.loyaltyPoints || 0) + parseInt(pts);
                    saveUsers();
                    renderLoyaltySection();
                    renderUsersTable();
                    updateStats();
                    showNotification('success', `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${pts} Ù†Ù‚Ø·Ø©`);
                }
            }
        }

        function quickSubPoints(userId) {
            const pts = prompt('Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·:');
            if (pts && !isNaN(pts)) {
                const u = users.find(x => x.id === userId);
                if (u) {
                    u.loyaltyPoints = Math.max(0, (u.loyaltyPoints || 0) - parseInt(pts));
                    saveUsers();
                    renderLoyaltySection();
                    renderUsersTable();
                    updateStats();
                    showNotification('success', `ØªÙ… Ø®ØµÙ… ${pts} Ù†Ù‚Ø·Ø©`);
                }
            }
        }

        function handlePointsAction(e) {
            e.preventDefault();
            const userId = parseInt(document.getElementById('pointsUserId').value);
            const action = document.getElementById('pointsAction').value;
            const amount = parseInt(document.getElementById('pointsAmount').value);
            const u = users.find(x => x.id === userId);
            if (!u) { showNotification('error', 'Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„'); return; }
            if (action === 'add') u.loyaltyPoints = (u.loyaltyPoints || 0) + amount;
            else u.loyaltyPoints = Math.max(0, (u.loyaltyPoints || 0) - amount);
            saveUsers();
            renderLoyaltySection();
            renderUsersTable();
            updateStats();
            closeModal('pointsModal');
            showNotification('success', 'ØªÙ…');
        }

        // ============================================
        // Store Settings
        // ============================================
        function loadSettingsToForms() {
            document.getElementById('storeName').value = storeSettings.name || '';
            document.getElementById('storeTagline').value = storeSettings.tagline || '';
            document.getElementById('storeDescription').value = storeSettings.description || '';
            document.getElementById('topBarText').value = storeSettings.topBar?.text || '';
            document.getElementById('topBarBgColor').value = storeSettings.topBar?.bgColor || '#0A1128';
            document.getElementById('topBarTextColor').value = storeSettings.topBar?.textColor || '#F4E4BC';
            document.getElementById('topBarEnabled').checked = storeSettings.topBar?.enabled !== false;
            document.getElementById('contactPhone').value = storeSettings.contact?.phone || '';
            document.getElementById('contactWhatsapp').value = storeSettings.contact?.whatsapp || '';
            document.getElementById('contactEmail').value = storeSettings.contact?.email || '';
            document.getElementById('contactAddress').value = storeSettings.contact?.address || '';
            document.getElementById('footerAbout').value = storeSettings.footer?.about || '';
            document.getElementById('workingHoursWeekdays').value = storeSettings.footer?.workingHoursWeekdays || '';
            document.getElementById('workingHoursFriday').value = storeSettings.footer?.workingHoursFriday || '';
            document.getElementById('workingHoursNote').value = storeSettings.footer?.workingHoursNote || '';
            document.getElementById('copyrightText').value = storeSettings.footer?.copyright || '';
        }

        function saveGeneralSettings(e) {
            e.preventDefault();
            storeSettings.name = document.getElementById('storeName').value.trim();
            storeSettings.tagline = document.getElementById('storeTagline').value.trim();
            storeSettings.description = document.getElementById('storeDescription').value.trim();
            saveStoreSettings();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function saveTopBarSettings(e) {
            e.preventDefault();
            storeSettings.topBar = {
                enabled: document.getElementById('topBarEnabled').checked,
                text: document.getElementById('topBarText').value.trim(),
                bgColor: document.getElementById('topBarBgColor').value,
                textColor: document.getElementById('topBarTextColor').value
            };
            saveStoreSettings();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function saveFooterSettings(e) {
            e.preventDefault();
            storeSettings.footer = {
                about: document.getElementById('footerAbout').value.trim(),
                workingHoursWeekdays: document.getElementById('workingHoursWeekdays').value.trim(),
                workingHoursFriday: document.getElementById('workingHoursFriday').value.trim(),
                workingHoursNote: document.getElementById('workingHoursNote').value.trim(),
                copyright: document.getElementById('copyrightText').value.trim()
            };
            saveStoreSettings();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function saveContactSettings(e) {
            e.preventDefault();
            storeSettings.contact = {
                phone: document.getElementById('contactPhone').value.trim(),
                whatsapp: document.getElementById('contactWhatsapp').value.trim(),
                email: document.getElementById('contactEmail').value.trim(),
                address: document.getElementById('contactAddress').value.trim()
            };
            saveStoreSettings();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function switchTab(name) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(name + 'Tab').classList.add('active');
        }

        // ============================================
        // Excel Export/Import
        // ============================================
        function exportProductsExcel() {
            const data = products.map(p => ({ 'Ø§Ù„Ø§Ø³Ù…': p.name, 'Ø§Ù„ÙˆØµÙ': p.desc, 'Ø§Ù„Ù‚Ø³Ù…': getCategoryName(p.category), 'Ø§Ù„Ø³Ø¹Ø±': p.price, 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…': p.oldPrice || '', 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…': p.rating, 'Ø§Ù„ØµÙˆØ±Ø©': p.image }));
            exportToExcel(data, 'products');
        }

        function exportOrdersExcel() {
            const data = orders.map(o => ({ 'Ø±Ù‚Ù…': o.orderNumber, 'Ø§Ù„Ø¹Ù…ÙŠÙ„': o.customer?.name, 'Ø§Ù„Ù‡Ø§ØªÙ': o.customer?.phone, 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': o.customer?.address, 'Ø§Ù„Ù…Ø¨Ù„Øº': o.total, 'Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†': o.couponCode || '', 'Ø§Ù„Ø®ØµÙ…': o.discount || 0, 'Ø§Ù„Ø­Ø§Ù„Ø©': getStatusName(o.status), 'Ø§Ù„ØªØ§Ø±ÙŠØ®': formatDate(o.createdAt) }));
            exportToExcel(data, 'orders');
        }

        function exportUsersExcel() {
            const data = users.map(u => ({ 'Ø§Ù„Ø§Ø³Ù…': u.name, 'Ø§Ù„Ù‡Ø§ØªÙ': u.phone, 'Ø§Ù„Ø¨Ø±ÙŠØ¯': u.email || '', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': u.address, 'Ø§Ù„Ù†Ù‚Ø§Ø·': u.loyaltyPoints || 0, 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„': formatDate(u.createdAt) }));
            exportToExcel(data, 'users');
        }

        function exportCouponsExcel() {
            const data = coupons.map(c => ({ 'Ø§Ù„ÙƒÙˆØ¯': c.code, 'Ø§Ù„ÙˆØµÙ': c.desc, 'Ø§Ù„Ù†ÙˆØ¹': c.type === 'percentage' ? 'Ù†Ø³Ø¨Ø©' : 'Ø«Ø§Ø¨Øª', 'Ø§Ù„Ù‚ÙŠÙ…Ø©': c.value }));
            exportToExcel(data, 'coupons');
        }

        function exportFullReport() {
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(products.map(p => ({ Ø§Ù„Ø§Ø³Ù…: p.name, Ø§Ù„Ù‚Ø³Ù…: getCategoryName(p.category), Ø§Ù„Ø³Ø¹Ø±: p.price }))), 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(orders.map(o => ({ Ø±Ù‚Ù…: o.orderNumber, Ø§Ù„Ø¹Ù…ÙŠÙ„: o.customer?.name, Ø§Ù„Ù…Ø¨Ù„Øº: o.total, Ø§Ù„Ø­Ø§Ù„Ø©: getStatusName(o.status) }))), 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª');
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(users.map(u => ({ Ø§Ù„Ø§Ø³Ù…: u.name, Ø§Ù„Ù‡Ø§ØªÙ: u.phone, Ø§Ù„Ù†Ù‚Ø§Ø·: u.loyaltyPoints || 0 }))), 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡');
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet([{ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: products.length, Ø§Ù„Ø·Ù„Ø¨Ø§Øª: orders.length, Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: users.length, Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: orders.reduce((s, o) => s + (o.total || 0), 0) }]), 'Ù…Ù„Ø®Øµ');
            XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±-${Date.now()}.xlsx`);
            showNotification('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
        }

        function exportToExcel(data, name) {
            if (data.length === 0) { showNotification('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, name);
            XLSX.writeFile(wb, `${name}-${Date.now()}.xlsx`);
            showNotification('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
        }

        function importProductsExcel(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const wb = XLSX.read(ev.target.result, { type: 'binary' });
                    const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                    let count = 0;
                    data.forEach(row => {
                        if (row['Ø§Ù„Ø§Ø³Ù…'] && row['Ø§Ù„Ø³Ø¹Ø±']) {
                            products.push({ id: Date.now() + Math.random(), name: row['Ø§Ù„Ø§Ø³Ù…'], desc: row['Ø§Ù„ÙˆØµÙ'] || '', category: 'supplements', price: parseFloat(row['Ø§Ù„Ø³Ø¹Ø±']), oldPrice: parseFloat(row['Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…']) || null, image: row['Ø§Ù„ØµÙˆØ±Ø©'] || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNTAgMTkwQzEzNS4wNDYgMTkwIDEyMy4yOTkgMTc4LjI1MyAxMjMuMjk5IDE2M0MxMjMuMjk5IDE0Ny43NDcgMTM1LjA0NiAxMzYgMTUwIDEzNkMxNjQuOTU0IDEzNiAxNzYuNzAxIDE0Ny43NDcgMTc2LjcwMSAxNjNDMTc2LjcwMSAxNzguMjUzIDE2NC45NTQgMTkwIDE1MCAxOTBaIiBmaWxsPSIjOUNDOUNDOSIvPgo8L3N2Zz4K', rating: 4.5, ratingCount: 0 });
                            count++;
                        }
                    });
                    saveProducts();
                    renderProductsTable();
                    updateStats();
                    showNotification('success', `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${count} Ù…Ù†ØªØ¬`);
                } catch (err) { showNotification('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù'); }
            };
            reader.readAsBinaryString(file);
            e.target.value = '';
        }

        // ============================================
        // JSON Backup
        // ============================================
        function exportAllDataJSON() {
            const data = { products, orders, coupons, banners, users, storeSettings };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `backup-${Date.now()}.json`;
            a.click();
            showNotification('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
        }

        function importAllDataJSON(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (data.products) { products = data.products; saveProducts(); }
                    if (data.orders) { orders = data.orders; saveOrders(); }
                    if (data.coupons) { coupons = data.coupons; saveCoupons(); }
                    if (data.banners) { banners = data.banners; saveBanners(); }
                    if (data.users) { users = data.users; saveUsers(); }
                    if (data.storeSettings) { storeSettings = data.storeSettings; saveStoreSettings(); }
                    initDashboard();
                    showNotification('success', 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
                } catch (err) { showNotification('error', 'Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        function clearAllData() {
            if (!confirm('âš ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
            if (!confirm('âš ï¸ Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!')) return;
            localStorage.clear();
            products = []; orders = []; coupons = []; banners = []; users = [];
            initDashboard();
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }

        async function changeAdminPassword(e) {
            e.preventDefault();
            const current = document.getElementById('currentAdminPass').value;
            const newPass = document.getElementById('newAdminPass').value;
            const confirm = document.getElementById('confirmAdminPass').value;
            if (newPass !== confirm) { showNotification('error', 'ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'); return; }
            const user = firebase.auth().currentUser;
            if (!user) { showNotification('error', 'Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'); return; }
            try {
                const cred = firebase.auth.EmailAuthProvider.credential(user.email, current);
                await user.reauthenticateWithCredential(cred);
                await user.updatePassword(newPass);
                showNotification('success', 'ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±');
                document.getElementById('currentAdminPass').value = '';
                document.getElementById('newAdminPass').value = '';
                document.getElementById('confirmAdminPass').value = '';
            } catch (err) {
                showNotification('error', 'ÙØ´Ù„ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            }
        }

        // ============================================
        // Charts
        // ============================================
        function initCharts() {
            const salesCtx = document.getElementById('salesChart')?.getContext('2d');
            if (salesCtx) {
                if (salesChart) salesChart.destroy();
                salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'],
                        datasets: [{ label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', data: [1200, 1900, 3000, 5000, 4000, 6000], borderColor: '#D4AF37', backgroundColor: 'rgba(212,175,55,0.1)', fill: true, tension: 0.4 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            const catCtx = document.getElementById('categoriesChart')?.getContext('2d');
            if (catCtx) {
                if (categoriesChart) categoriesChart.destroy();
                categoriesChart = new Chart(catCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ø´Ø¹Ø±', 'Ø¨Ø´Ø±Ø©', 'Ø·ÙÙ„', 'Ù…ÙƒÙ…Ù„Ø§Øª', 'Ø·Ø¨ÙŠ'],
                        datasets: [{ data: [products.filter(p => p.category === 'hair-care').length, products.filter(p => p.category === 'skin-care').length, products.filter(p => p.category === 'baby-care').length, products.filter(p => p.category === 'supplements').length, products.filter(p => p.category === 'medical').length], backgroundColor: ['#B76E79', '#E8A0BF', '#7EC8E3', '#4CAF50', '#2196F3'] }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
        }

        // ============================================
        // UI
        // ============================================
        function showSection(name) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(name + 'Section').classList.add('active');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            event?.target?.classList.add('active');
            const titles = { overview: 'ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', products: 'ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', orders: 'ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', banners: 'ğŸ  Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª', coupons: 'ğŸ« Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª', users: 'ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', loyalty: 'ğŸ’ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡', reports: 'ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', storeSettings: 'ğŸª Ø§Ù„Ù…ØªØ¬Ø±', settings: 'âš™ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…' };
            document.getElementById('pageTitle').textContent = titles[name] || name;
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(modalId) {
  document.getElementById(modalId)?.classList.remove('active');
  if (modalId === 'productModal') resetProductForm();
}

        document.querySelectorAll('.modal-overlay').forEach(o => {
            o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); });
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
        });

        function showNotification(type, message) {
            const container = document.getElementById('notificationsContainer');
            const n = document.createElement('div');
            n.className = `notification ${type}`;
            n.innerHTML = `<div class="notification-icon">${type === 'success' ? 'âœ“' : 'âœ•'}</div><div class="notification-content"><div class="notification-title">${type === 'success' ? 'Ù†Ø¬Ø§Ø­' : 'Ø®Ø·Ø£'}</div><div class="notification-message">${message}</div></div><button class="notification-close" onclick="this.parentElement.remove()">âœ•</button>`;
            container.appendChild(n);
            setTimeout(() => n.remove(), 4000);
        }
    </script>
    <script>
async function uploadAndPreview(input) {
    if(!input.files[0]) return;
    // Ù…Ø¹Ø§ÙŠÙ†Ø©
    const reader = new FileReader();
    reader.onload = (e) => document.getElementById('imgPreview').innerHTML = `<img src="${e.target.result}" style="max-width:150px;border-radius:5px;margin:5px 0;">`;
    reader.readAsDataURL(input.files[0]);
    
    // Ø±ÙØ¹
    try {
        const res = await uploadToCloudinary(input.files[0]);
        if(res) {
            document.getElementById('finalImg').value = res.url;
            document.getElementById('manualImg').value = res.url;
            alert('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
        }
    } catch(err) {
        alert('âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ' + err.message);
    }
}
</script>
</body>
</html>
