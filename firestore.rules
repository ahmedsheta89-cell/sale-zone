rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ğŸ›¡ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¹Ø§Ù…Ø©
    
    // ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /products/{productId} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸŸï¸ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /coupons/{couponId} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸª Ø§Ù„Ø¨anners - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /banners/{bannerId} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /customers/{customerId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©
    match /orders/{orderId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow create: if request.auth != null && 
        request.auth.token.admin == true;
      allow update: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ” Ø§Ù„Ø£Ø¯Ù…Ù† - Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙÙ‚Ø·
    match /admins/{adminId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow create: if false; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /settings/{settingId} {
      allow read: if true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /analytics/{analyticsId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ›’ Ø§Ù„Ø³Ù„Ø© - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
    match /carts/{cartId} {
      allow read: if request.auth != null && 
        request.auth.uid == cartId;
      allow write: if request.auth != null && 
        request.auth.uid == cartId;
      allow delete: if request.auth != null && 
        request.auth.uid == cartId;
    }
    
    // â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø© - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
    match /favorites/{favoriteId} {
      allow read: if request.auth != null && 
        request.auth.uid == favoriteId;
      allow write: if request.auth != null && 
        request.auth.uid == favoriteId;
      allow delete: if request.auth != null && 
        request.auth.uid == favoriteId;
    }
    
    // ğŸ“ Ø§Ù„Ø³Ø¬Ù„Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /logs/{logId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ” Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    match /errors/{errorId} {
      allow read: if request.auth != null && 
        request.auth.token.admin == true;
      allow write: if request.auth != null && 
        request.auth.token.admin == true;
      allow delete: if request.auth != null && 
        request.auth.token.admin == true;
    }
    
    // ğŸ“± Ø§Ù„Ø¬Ù„Ø³Ø§Øª - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
    match /sessions/{sessionId} {
      allow read: if request.auth != null && 
        request.auth.uid == sessionId;
      allow write: if request.auth != null && 
        request.auth.uid == sessionId;
      allow delete: if request.auth != null && 
        request.auth.uid == sessionId;
    }
    
    // ğŸ”„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
    match /sync/{syncId} {
      allow read: if request.auth != null && 
        request.auth.uid == syncId;
      allow write: if request.auth != null && 
        request.auth.uid == syncId;
      allow delete: if request.auth != null && 
        request.auth.uid == syncId;
    }
    
    // ğŸ›¡ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    
    // Ù…Ù†Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¶Ø§Ø±Ø©
    match /{document=**} {
      // Ù…Ù†Ø¹ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
      allow delete: if request.auth != null && 
        request.auth.token.admin == true &&
        request.query.limit <= 100;
      
      // Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
      allow list: if request.auth != null && 
        request.auth.token.admin == true &&
        request.query.limit <= 1000;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      allow write: if request.resource.data.size() < 1000000; // 1MB max
    }
    
    // ğŸ•’ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙˆÙ‚Øª
    match /{document=**} {
      // Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      allow update: if request.auth != null && 
        request.auth.token.admin == true &&
        (request.resource.data.createdAt == null || 
         request.resource.data.createdAt > timestamp.date(timestamp.now().year, timestamp.now().month, timestamp.now().day - 30));
    }
    
    // ğŸŒ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©
    match /{document=**} {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±
      allow read, write: if 
        request.auth != null && 
        request.headers['x-forwarded-for'] != null &&
        request.headers['user-agent'] != null;
    }
    
    // ğŸ“Š Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
    match /{document=**} {
      // ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
      allow read, write: if 
        request.auth != null && 
        request.time < timestamp.date(2026, 12, 31);
    }
  }
}
